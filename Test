# PRD Section
$clients = "bhar", "bhme", "cchhs"
$prdUsedSpace = @{}  # Create a hashtable to store PRD used space values

foreach ($client in $clients) {
    $server = "ptlprddb$client" + "01.chicago.local"
    $disk = Get-WmiObject Win32_logicaldisk -ComputerName $server -Filter "DeviceID='G:'"
    $usedGB = [decimal]($disk.Size / 1gb - $disk.FreeSpace / 1gb)
    $prdUsedSpace[$client] = $usedGB  # Store used space in the hashtable
}

# UAT Section
$uatTotalSpace = @{}  # Create a hashtable to store UAT total space values

foreach ($client in $clients) {
    $server = "ptluatdb$client" + "01.chicago.local"
    $disk = Get-WmiObject Win32_logicaldisk -ComputerName $server -Filter "DeviceID='G:'"
    $sizeGB = [decimal]($disk.Size / 1gb)
    $uatTotalSpace[$client] = $sizeGB  # Store total space in the hashtable
}

# Create an HTML table
$htmlTable = "<table border='1'><tr><th>Client</th><th>Drive ID</th><th>Space Needed (GB)</th></tr>"

# Compare PRD and UAT and add rows to the HTML table only when space is needed
foreach ($client in $clients) {
    $difference = $prdUsedSpace[$client] - $uatTotalSpace[$client]
    if ($difference > 0) {
        $htmlTable += "<tr><td>$client</td><td>G:</td><td>$difference</td></tr>"
    }
}

$htmlTable += "</table>"

# Output the HTML table
if ($htmlTable -ne "<table border='1'><tr><th>Client</th><th>Drive ID</th><th>Space Needed (GB)</th></tr></table>") {
    Write-Output $htmlTable
}
