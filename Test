# Function to fetch disk information and calculate used space
function Get-UsedSpace($driveLetter, $server) {
    $disk = Get-WmiObject Win32_logicaldisk -ComputerName $server -Filter "DeviceID='$driveLetter:'"
    return [decimal]($disk.Size / 1gb - $disk.FreeSpace / 1gb)
}

# Function to fetch total disk space
function Get-TotalSpace($driveLetter, $server) {
    $disk = Get-WmiObject Win32_logicaldisk -ComputerName $server -Filter "DeviceID='$driveLetter:'"
    return [decimal]($disk.Size / 1gb)
}

# Define clients
$clients = "BHAR", "BHME", "CCHHS", "LWWA", "MAMC", "MPMD", "NMHC", "NPA", "PHKY", "PMAK", "PMWA", "SMNY"

# PORTAL SERVERS
Write-Output "PORTAL SERVERS"

# PRD and UAT for J Drive
foreach ($client in $clients) {
    # PRD Servers
    $prdServerJ = "aldprddb$client" + "01.chicago.local"
    $prdUsedSpaceJ = Get-UsedSpace 'J' $prdServerJ

    # UAT Servers
    $uatServerJ = "alduatdb$client" + "01.chicago.local"
    $uatTotalSpaceJ = Get-TotalSpace 'J' $uatServerJ

    $difference = $uatTotalSpaceJ - $prdUsedSpaceJ
    if ($difference -gt 0) {
        "Client: $client`tDrive ID: J`tSpace Needed (GB): $($difference * -1)"
    }
}

# PRD and UAT for I Drive
foreach ($client in $clients) {
    # PRD Servers
    $prdServerI = "aldprddb$client" + "01.chicago.local"
    $prdUsedSpaceI = Get-UsedSpace 'I' $prdServerI

    # UAT Servers
    $uatServerI = "alduatdb$client" + "01.chicago.local"
    $uatTotalSpaceI = Get-TotalSpace 'I' $uatServerI

    $difference = $uatTotalSpaceI - $prdUsedSpaceI
    if ($difference -gt 0) {
        "Client: $client`tDrive ID: I`tSpace Needed (GB): $($difference * -1)"
    }
}

# CORE SERVERS
Write-Output "CORE SERVERS"

# PRD and UAT for G Drive
foreach ($client in $clients) {
    # PRD Servers
    $prdServerG = "ptlprddb$client" + "01.chicago.local"
    $prdUsedSpaceG = Get-UsedSpace 'G' $prdServerG

    # UAT Servers
    $uatServerG = "ptluatdb$client" + "01.chicago.local"
    $uatTotalSpaceG = Get-TotalSpace 'G' $uatServerG

    $difference = $uatTotalSpaceG - $prdUsedSpaceG
    if ($difference -lt 0) {
        "Client: $client`tDrive ID: G`tSpace Needed (GB): $($difference * -1)"
    }
}
